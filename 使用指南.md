# 高鐵票券自動監控系統 - 完整使用指南

## 🚀 系統功能特色

✅ **自動驗證碼識別**：使用 ddddocr AI 技術自動解決驗證碼  
✅ **智能反偵測**：多重反自動化偵測機制  
✅ **三情境精準處理**：驗證碼錯誤、查無車次、找到車票  
✅ **LINE Bot 即時通知**：透過專屬 LINE Bot 即時推播到手機  
✅ **無限監控**：24小時不間斷監控直到找到車票  
✅ **智能冷卻**：避免過度請求被封鎖  

## 📋 系統需求

- Python 3.11+
- Windows 作業系統
- Chrome 瀏覽器
- 穩定的網路連線

## 🛠️ 安裝步驟

### 1. 安裝 Python 依賴套件
```bash
uv add selenium beautifulsoup4 ddddocr webdriver-manager requests pillow
```

### 2. 設定監控參數

編輯 `main.py` 檔案中的設定區：

```python
# 高鐵查詢設定
START_STATION = '2'         # 起始站 (台北)
END_STATION = '10'          # 終點站 (嘉義)
SEARCH_DATE = '2025/09/26'  # 查詢日期 (格式：YYYY/MM/DD)
SEARCH_TIME = '600P'        # 查詢時間 (網站格式：600P = 18:00)

# 程式執行設定
CHECK_INTERVAL_SECONDS = 90  # 查無票時的冷卻間隔 (秒)
MAX_CAPTCHA_RETRIES = 3      # 驗證碼最大重試次數
```

### 3. 設定 LINE Bot 通知（可選）

#### 選擇通知方式
程式支援兩種 LINE 通知方式：

**方案 A：LINE Bot API（推薦，目前使用）**
- ✅ 專屬 Bot，可自訂名稱和頭像
- ✅ 支援豐富訊息格式
- ❌ 設定較複雜
- ❌ 每月 1000 則免費訊息（超過需付費）

**方案 B：LINE Notify（簡單版）**
- ✅ 設定簡單，完全免費
- ❌ 只能從「LINE Notify」官方帳號發送

#### 設定 LINE Bot API
1. 前往 [LINE Developers Console](https://developers.line.biz/)
2. 建立 Messaging API Channel
3. 取得 Channel Access Token 和 User ID
4. 將資訊填入設定：

```python
# LINE Bot API 設定
LINE_CHANNEL_ACCESS_TOKEN = "你的Channel_Access_Token"
LINE_USER_ID = "你的User_ID"
```

詳細步驟請參考 `LINE_Bot_API_設定說明.md`

#### 測試設定
```bash
python test_line_bot.py
```

## 🎯 站點代碼對照表

| 站名 | 代碼 | 站名 | 代碼 |
|------|------|------|------|
| 南港 | 1    | 彰化 | 9    |
| 台北 | 2    | 雲林 | 10   |
| 板橋 | 3    | 嘉義 | 11   |
| 桃園 | 4    | 台南 | 12   |
| 新竹 | 5    | 左營 | 13   |
| 苗栗 | 6    |      |      |
| 台中 | 7    |      |      |
| 烏日 | 8    |      |      |

## ⏰ 時間格式說明

高鐵網站使用特殊的時間格式：

| 實際時間 | 網站格式 | 實際時間 | 網站格式 |
|----------|----------|----------|----------|
| 06:00    | 600A     | 15:00    | 300P     |
| 07:00    | 700A     | 16:00    | 400P     |
| 08:00    | 800A     | 17:00    | 500P     |
| 09:00    | 900A     | 18:00    | 600P     |
| 10:00    | 1000A    | 19:00    | 700P     |
| 11:00    | 1100A    | 20:00    | 800P     |
| 12:00    | 1200N    | 21:00    | 900P     |
| 13:00    | 100P     | 22:00    | 1000P    |
| 14:00    | 200P     | 23:00    | 1100P    |

## 🚀 執行程式

```bash
cd c:\Users\scott\OneDrive\Desktop\tttt
python main.py
```

## 📱 監控流程

### 1. 程式啟動
```
🚀 高鐵監控程式已啟動
目標日期：2025/09/26 600P
路線：台北 → 嘉義
開始監控中...
```

### 2. 監控過程
- 自動開啟高鐵網站
- 填入查詢條件
- 自動識別驗證碼
- 分析查詢結果

### 3. 三種結果處理

#### 🔄 驗證碼錯誤
```
❌ 驗證碼輸入錯誤，重新嘗試... (第 1/3 次)
等待 2 秒後重試...
```

#### ⏳ 查無可售車次
```
⚠️ 查無可售車次，90秒後重新查詢...
等待中... 剩餘 90 秒
```

#### 🎉 找到車票！
```
🎉 查詢有票！趕快訂購！
查詢目標：2025/09/26 從 台北 到 嘉義
請儘速前往高鐵網站訂票：https://irs.thsrc.com.tw/
```

## 📲 LINE Bot 通知功能

程式會在以下時機發送 LINE Bot 通知：

1. **程式啟動**：確認監控開始
2. **找到車票**：第一時間通知搶票  
3. **程式結束**：手動停止或錯誤結束
4. **發生錯誤**：異常狀況通知

通知訊息會從您的專屬 LINE Bot 發送，可自訂 Bot 名稱和頭像。

## ⚠️ 注意事項

### 使用建議
- 建議在車票開放購買前 30 分鐘啟動監控
- 程式會持續運行直到找到車票，請確保電腦不會休眠
- 收到找票通知後請立即前往官網完成訂票

### 安全說明
- 本程式僅用於合法的票務查詢
- 不會自動訂購車票，只會通知有票訊息
- 請勿過度頻繁查詢造成網站負擔

### 疑難排解
- 如果程式無法啟動，請檢查 Chrome 瀏覽器是否已安裝
- 驗證碼識別失敗太多次時會自動重新整理頁面
- 網路異常時程式會自動重試

## 📁 檔案說明

- `main.py` - 主要監控程式
- `test_anti_detection.py` - 功能測試版本
- `LINE_設定說明.md` - LINE 通知設定詳細說明
- `pyproject.toml` - 專案依賴配置

## 🆘 技術支援

如遇到問題：
1. 檢查網路連線
2. 確認 Chrome 瀏覽器版本
3. 重新啟動程式
4. 查看錯誤訊息並對應解決

---

**祝您順利搶到車票！🚄**